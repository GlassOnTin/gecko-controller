#!/usr/bin/make -f

export PYBUILD_NAME=gecko_controller
export DH_VERBOSE=1

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_build:
	# Build Python package
	python3 setup.py build
	# Build JavaScript with production settings
	cd gecko_controller/web/static && \
	npm ci && \
	NODE_ENV=production npm run build:prod

override_dh_auto_install:
	dh_auto_install
	# Create required directories
	mkdir -p debian/gecko-controller/etc/gecko-controller
	mkdir -p debian/gecko-controller/lib/systemd/system
	mkdir -p debian/gecko-controller/usr/share/gecko-controller/web/static
	mkdir -p debian/gecko-controller/usr/share/gecko-controller/web/templates
	# Install configuration
	install -m644 debian/config.py debian/gecko-controller/etc/gecko-controller/config.py
	# Install systemd services
	install -m644 debian/gecko-controller.service debian/gecko-controller/lib/systemd/system/
	install -m644 debian/gecko-web.service debian/gecko-controller/lib/systemd/system/
	# Install web assets
	cp -r gecko_controller/web/static/dist/* debian/gecko-controller/usr/share/gecko-controller/web/static/
	cp -r gecko_controller/web/templates/* debian/gecko-controller/usr/share/gecko-controller/web/templates/
